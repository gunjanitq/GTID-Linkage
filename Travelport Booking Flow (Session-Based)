# Travelport Booking Flow (Session-Based)

When working with **Travelport APIs (uAPI)**, creating a booking is a multi-step process, where each request builds upon the previous one using a **Session Key (Session Token).**

---
### Step 1: Start Booking Session

1. API: **BookingStartReq**
2. Purpose: Start a session with Travelport for the branch you’re targeting.
3. Input: Branch code (PCC), target branch ID.
4. Output: Session Key (like a session ID).
5. This Session Key must be carried forward in all subsequent requests.
---
### Step 2: Add Air Segments

6. API: **AirCreateReservationReq** (older) or **BookingAirSegmentReq**
7. Purpose: Add flight segments into the PNR.
8. Input:

   * Air Segment Key (from AirPriceShop / AirAvailability response)
   * Last Line Number
   * Party size (number of passengers)
9. Output:

   * Session ID (carried forward, often twice as per your notes)
   * Air Segment Reference
---
### Step 3: Add Traveller Information

10. API: **BookingTravelerReq** or included in **AirCreateReservationReq**
11. Purpose: Attach passenger details.
12. Input:
    * Passenger names
    * Date of birth, gender, type (ADT, CHD, INF)
13. Note: Each traveler gets a **Traveler Key** which must be used in pricing and ticketing later.
---
### Step 4: Pricing Request

14. API: **AirPriceReq** or **BookingPricingReq**
15. Purpose: Get the fare, rules, penalties, and confirm pricing.
16. Input:
    * Session Key
    * Air Segment Keys
    * Traveler Keys
17. Additional:
    * Add Modifiers (e.g., Brand modifiers, Cabin preference, Penalty checks).
    * Remove host tokens (temporary data from booking info).
18. Output:
    * Air Pricing Solution (with fare basis, brand details, taxes, penalties)
    * Booking Pricing Reference Key.
---
### Step 5: Review Cancel Penalty (Optional)

19. Check refund/cancellation policies.
20. Apply **AirPricingModifiers** (like low-cost carrier rules, branded fares).
---
### Step 6: Finalize Reservation

21. Remove unnecessary tokens/keys (like Brand Key if not needed).
22. Confirm the reservation with all pricing details.
23. Store PNR → a Locator Code (record locator) is returned.
---
### Step 7: Issue Ticket

24. API: **AirTicketingReq**
25. Input: PNR Locator Code, form of payment (FOP), PCC.
26. Output: E-ticket number(s).
---
### Notes

27. Session Key is reused multiple times (at least twice).
28. Air Segment Key (SegRef) is crucial to connect search results → booking.
29. Booking Traveler Key must match PAX types.
30. After cancel penalty → add **AirPricingModifier**.
31. Remove after Brand Key → means cleaning up extra XML tags before commit.
---
### End-to-End Flow in Order
BookingStartReq      → Get Session Key
BookingAirSegmentReq → Add flight segments
BookingTravelerReq   → Add passenger details
BookingPricingReq    → Get confirmed pricing & rules
(Optional) Apply cancel penalty / modifiers
Commit booking       → Receive PNR
AirTicketingReq      → Issue tickets
